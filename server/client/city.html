<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
    <title>Quest</title>
  </head>
  <body class="h-screen w-full bg-black font-[Pixelify_Sans]">
      <div id="screen" class="h-screen w-full bg-[url(./assets/city.png)] bg-cover bg-center]">
      <!-- <div id="screen" class="h-screen w-full bg-[url(./assets/buildings_sprites/cafe.png)] bg-size-[800px] bg-center bg-no-repeat"> -->
      <!-- <div id="screen" class="h-screen w-full bg-[url(./assets/buildings_sprites/shop.png)] bg-size-[800px] bg-center bg-no-repeat"> -->
      <div>
        <img id="cafe-dialogue-intro" class="hidden w-[260px] h-[52px] absolute top-[24vh] left-[48vw]" src="./assets/dialogues/cafe_intro.gif" alt="">
        <img id="cafe-dialogue-outro" class="hidden w-[200px] h-[64px] absolute top-[24vh] left-[48vw]" src="./assets/dialogues/cafe_outro.gif" alt="">

        <img id="shop-dialogue-intro" class="hidden w-[240px] h-[64px] absolute top-[22vh] left-[36vw]" src="./assets/dialogues/shop_intro.gif" alt="">
        <img id="shop-dialogue-outro" class="hidden w-[240px] h-[84] absolute top-[17vh] left-[36vw]" src="./assets/dialogues/shop_outro.gif" alt="">

        <p id="name_tag" class="text-white absolute top-[47vh] left-[50vw]">Player</p>
        <img id="player" class="w-[33px] h-[48px] absolute top-[50vh] left-[50vw]" src="./assets/player_sprites/front_stand.png" alt="">
        <img id="certificate" class="hidden w-[1000px] h-[500] absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2" src="./assets/utilities/certificate.png" alt="">
      </div>
    </div>

    <script>
    // ---- variables ----
    state = 0
    // screen = "start"
    screen = "city"
    // screen = "cafe"
    // screen = "shop"

    // ---- GET profile ----
    url = "http://localhost:8000/api/profile"

    async function get_profile() {
      const response = await fetch(url)
      const data = await response.json()
      // console.log(data)

      $("#name_tag").text(data.name)

      if(data.energy >= 100 && data.stress <= 0 && data.happiness >= 100) {
        $("#certificate").css("display", "inline")
      }

      return data
    }
    get_profile()

    // ---- movement ----
    $("body").on("keypress", async (e) => {
      console.log(e.which)

      const player = $("#player")
      const position = player.position()
      console.log(position)

      const name = $("#name_tag")

      prev_x = position.left
      prev_y = position.top

      prev_name_x = name.position().left
      prev_name_y = name.position().top

      if(e.which == 119) {
        state = state ? 0 : 1
        player.attr("src", `./assets/player_sprites/back_walk_${state + 1}.png`)
        player.css("width", "33")
        player.css("height", "44px")
        player.css("top", `${prev_y-20}px`)
        name.css("top", `${prev_name_y-20}px`)
      }
      if(e.which == 115) {
        state = state ? 0 : 1
        player.attr("src", `./assets/player_sprites/front_walk_${state + 1}.png`)
        player.css("width", "33px")
        player.css("height", "48px")
        player.css("top", `${prev_y+20}px`)
        name.css("top", `${prev_name_y+20}px`)
      }
      if(e.which == 97) {
        state = state ? 0 : 1
        player.attr("src", `./assets/player_sprites/left_walk_${state + 1}.png`)
        player.css("width", "42px")
        player.css("height", "42px")
        player.css("left", `${prev_x-20}px`)
        name.css("left", `${prev_name_x-20}px`)
      }
      if(e.which == 100) {
        state = state ? 0 : 1
        player.attr("src", `./assets/player_sprites/right_walk_${state + 1}.png`)
        player.css("width", "42px")
        player.css("height", "42px")
        player.css("left", `${prev_x+20}px`)
        name.css("left", `${prev_name_x+20}px`)
      }

      // ---- player card ----
      if(e.which == 106) {
        data = await get_profile()
        console.log(data)
      }

      // ---- CAFE ----
      if(e.which == 107 && screen == "city" && ((position.top >= 99 && position.left >= 277) && (position.top <= 319 && position.left <= 537)))  {
        // $("#screen").css({
        //   "background-image": "url(./assets/buildings_sprites/cafe.png)",
        //   "background-size": "800px",
        //   "background-position": "center",
        //   "background-repeat": "no-repeat"
        // })
        // player.css("top", "50vh")
        // player.css("left", "50vw")
        // name.css("top", "47vh")
        // name.css("left", "50vw")
        //
        // screen = "cafe"
        window.open("./cafe.html", "_self")
      }

      // ---- cafe dialogue ----
      // if(e.which == 107 && screen == "cafe") {
      //   console.log(screen)
      //   $("#cafe-dialogue-intro").css("display", "inline")
      // }

      // ---- SHOP ----
      if(e.which == 107 && screen == "city" && ((position.top >= 699 && position.left >= 1217) && (position.top <= 759 && position.left <= 1437)))  {
        // $("#screen").css({
        //   "background-image": "url(./assets/buildings_sprites/shop.png)",
        //   "background-size": "800px",
        //   "background-position": "center",
        //   "background-repeat": "no-repeat"
        // })
        // player.css("top", "50vh")
        // player.css("left", "50vw")
        // name.css("top", "47vh")
        // name.css("left", "50vw")
        //
        // screen = "shop"
        window.open("./shop.html", "_self")
      }

      // ---- shop dialogue ----
      // if(e.which == 107 && screen == "shop") {
      //   console.log(screen)
      //   $("#shop-dialogue-intro").css("display", "inline")
      // }
    })
    </script>
  </body>
</html>

